name: Generate Intelligence Brief

on:
  schedule:
    - cron: '0 7 * * *'
  workflow_dispatch:

jobs:
  generate-brief:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: pip install requests python-dateutil
        
    - name: Create script
      run: |
        cat > generate.py << 'ENDOFFILE'
        import requests
        import os
        from datetime import datetime

        def generate_with_grok(prompt):
            api_key = os.environ.get('GROK_API_KEY')
            if not api_key:
                return None, "No Grok API key"
            
            try:
                system_msg = "You are a SIGINT analyst with real-time access to X/Twitter. Your mission: Monitor specific high-value accounts for intelligence indicators. Treat X posts as SIGNALS - raw intercepts requiring analysis and correlation. Cross-reference multiple sources to verify. Identify patterns and strategic implications. Report using intelligence terminology: OSINT sources, SIGINT collection, pattern analysis, strategic assessment. You have direct access to X RIGHT NOW - actively search and monitor the accounts specified in the briefing request."
                
                data = {
                    'messages': [
                        {'role': 'system', 'content': system_msg},
                        {'role': 'user', 'content': prompt}
                    ],
                    'model': 'grok-4-1-fast-reasoning',
                    'stream': False,
                    'temperature': 0.6,
                    'max_tokens': 4500
                }
                
                response = requests.post(
                    'https://api.x.ai/v1/chat/completions',
                    headers={
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + api_key
                    },
                    json=data,
                    timeout=90
                )
                
                if response.status_code == 200:
                    return response.json()['choices'][0]['message']['content'], None
                else:
                    return None, "Grok error: " + str(response.status_code)
            except Exception as e:
                return None, str(e)

        def generate_with_groq(prompt):
            api_key = os.environ.get('GROQ_API_KEY')
            if not api_key:
                return None, "No Groq API key"
            
            try:
                response = requests.post(
                    'https://api.groq.com/openai/v1/chat/completions',
                    headers={
                        'Authorization': 'Bearer ' + api_key,
                        'Content-Type': 'application/json'
                    },
                    json={
                        'model': 'llama-3.3-70b-versatile',
                        'messages': [{'role': 'user', 'content': prompt}],
                        'temperature': 0.6,
                        'max_tokens': 4000
                    },
                    timeout=60
                )
                
                if response.status_code == 200:
                    return response.json()['choices'][0]['message']['content'], None
                return None, "Groq error"
            except Exception as e:
                return None, str(e)

        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M UTC')
        readable_date = datetime.now().strftime('%B %d, %Y at %H:%M UTC')
        year = str(datetime.now().year)

        prompt_text = "SIGINT COLLECTION TASKING - REAL-TIME X/TWITTER MONITORING\nCollection Period: Past 24 hours ending " + readable_date + "\nCurrent Year: " + year + "\n\nMISSION: Monitor high-value X accounts for intelligence indicators. Analyze signals, correlate data, assess strategic implications.\n\nPRIORITY INTELLIGENCE REQUIREMENTS:\n\n1. GEOPOLITICAL AND MILITARY INTELLIGENCE\n\nPRIMARY COLLECTION TARGETS (Government/Military):\n@POTUS @VP @StateDept @SecDef @DeptofDefense @NATO @EUCOM @CENTCOM @INDOPACOM @Europarl_EN @EU_Commission @BorisJohnson @EmmanuelMacron @Bundeskanzler @ZelenskyyUa @Ukrainian_Army @DefenceU @KremlinRussia_E @IDF @Israel_MOD @IsraeliPM @IRGC_Bismillah @Taiwan_SEC @MFA_China @XHNews @StateDeptSpox @PentagonPresSec\n\nSECONDARY SOURCES (Journalists/Analysts):\n@christogrozev @RALee85 @Conflicts @WarMonitors @Osinttechnical @JackDetsch @laraseligman @NatashaBertrand @helenenecostier\n\nCollection Focus:\n- Troop movements and military deployments\n- Diplomatic statements and policy shifts\n- Alliance developments and joint operations\n- Sanctions announcements and economic warfare\n- Arms transfers and defense aid packages\n- Strategic messaging and information operations\n\n2. TECHNOLOGY AND CYBERSECURITY INTELLIGENCE\n\nPRIMARY TARGETS (Tech Leaders/Companies):\n@elonmusk @sama @satyanadella @sundarpichai @tim_cook @OpenAI @Google @Microsoft @Apple @Meta @Tesla @SpaceX @xAI @USCYBERCOM @CISAgov @NSACyber @FBI\n\nSECONDARY SOURCES (Security​​​​​​​​​​​​​​​​
