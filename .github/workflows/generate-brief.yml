name: Generate Intelligence Brief

on:
  schedule:
    - cron: '0 7 * * *'
  workflow_dispatch:

jobs:
  generate-brief:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: pip install requests python-dateutil
        
    - name: Create script
      run: |
        cat > generate.py << 'ENDOFFILE'
        import requests
        import os
        from datetime import datetime

        def generate_with_grok(prompt):
            api_key = os.environ.get('GROK_API_KEY')
            if not api_key:
                return None, "No Grok API key"
            
            try:
                system_msg = "You are a SIGINT analyst with real-time access to X/Twitter. Your mission: Monitor specific high-value accounts for intelligence indicators. Treat X posts as SIGNALS - raw intercepts requiring analysis and correlation. Cross-reference multiple sources to verify. Identify patterns and strategic implications. Report using intelligence terminology: OSINT sources, SIGINT collection, pattern analysis, strategic assessment. You have direct access to X RIGHT NOW - actively search and monitor the accounts specified in the briefing request."
                
                data = {
                    'messages': [
                        {'role': 'system', 'content': system_msg},
                        {'role': 'user', 'content': prompt}
                    ],
                    'model': 'grok-4-1-fast-reasoning',
                    'stream': False,
                    'temperature': 0.6,
                    'max_tokens': 4500
                }
                
                response = requests.post(
                    'https://api.x.ai/v1/chat/completions',
                    headers={
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + api_key
                    },
                    json=data,
                    timeout=90
                )
                
                if response.status_code == 200:
                    return response.json()['choices'][0]['message']['content'], None
                else:
                    return None, "Grok error: " + str(response.status_code)
            except Exception as e:
                return None, str(e)

        def generate_with_groq(prompt):
            api_key = os.environ.get('GROQ_API_KEY')
            if not api_key:
                return None, "No Groq API key"
            
            try:
                response = requests.post(
                    'https://api.groq.com/openai/v1/chat/completions',
                    headers={
                        'Authorization': 'Bearer ' + api_key,
                        'Content-Type': 'application/json'
                    },
                    json={
                        'model': 'llama-3.3-70b-versatile',
                        'messages': [{'role': 'user', 'content': prompt}],
                        'temperature': 0.6,
                        'max_tokens': 4000
                    },
                    timeout=60
                )
                
                if response.status_code == 200:
                    return response.json()['choices'][0]['message']['content'], None
                return None, "Groq error"
            except Exception as e:
                return None, str(e)

        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M UTC')
        readable_date = datetime.now().strftime('%B %d, %Y at %H:%M UTC')
        year = str(datetime.now().year)

        prompt_text = """SIGINT COLLECTION TASKING - REAL-TIME X/TWITTER MONITORING
Collection Period: Past 24 hours ending """ + readable_date + """
Current Year: """ + year + """

MISSION: Monitor high-value X accounts for intelligence indicators. Analyze signals, correlate data, assess strategic implications.

PRIORITY INTELLIGENCE REQUIREMENTS (PIRs):

1. GEOPOLITICAL & MILITARY INTELLIGENCE

PRIMARY COLLECTION TARGETS (Government/Military):
@POTUS @VP @StateDept @SecDef @DeptofDefense @NATO @EUCOM @CENTCOM @INDOPACOM
@Europarl_EN @EU_Commission @BorisJohnson @EmmanuelMacron @Bundeskanzler
@ZelenskyyUa @Ukrainian_Army @DefenceU @KremlinRussia_E
@IDF @Israel_MOD @IsraeliPM @IRGC_Bismillah
@Taiwan_SEC @MFA_China @XHNews
@StateDeptSpox @PentagonPresSec

SECONDARY SOURCES (Journalists/Analysts):
@christogrozev @RALee85 @Conflicts @WarMonitors @Osinttechnical
@JackDetsch @laraseligman @NatashaBertrand @helenenecostier

Collection Focus:
- Troop movements and military deployments
- Diplomatic statements and policy shifts
- Alliance developments and joint operations
- Sanctions announcements and economic warfare
- Arms transfers and defense aid packages
- Strategic messaging and information operations

2. TECHNOLOGY & CYBERSECURITY INTELLIGENCE

PRIMARY TARGETS (Tech Leaders/Companies):
@elonmusk @sama @satyanadella @sundarpichai @tim_cook
@OpenAI @Google @Microsoft @Apple @Meta @Tesla @SpaceX @xAI
@USCYBERCOM @CISAgov @NSACyber @FBI

SECONDARY SOURCES (Security Researchers):
@mattblaze @evacide @thegrugq @SwiftOnSecurity @malwareunicorn
@troyhunt @briankrebs @nicoleperlroth

Collection Focus:
- Product launches and technology breakthroughs
- Cybersecurity incidents and vulnerability disclosures
- AI model releases and policy announcements
- Acquisitions and strategic partnerships
- Regulatory actions and antitrust developments
- Critical infrastructure threats

3. UAP/UFO INTELLIGENCE

PRIMARY TARGETS:
@DeptofDefense @AARO_DOD_Info @SenGillibrand @RepTimBurchett
@SenRubioPress @RepJaredMoskowitz

SECONDARY SOURCES:
@ChrisKMellon @LueElizondo @rosscoulthart @JeremyCorbell
@GadiNBC @TheUfoJoe

Collection Focus:
- Official Pentagon statements and AARO releases
- Congressional hearing announcements
- Legislation and oversight activities
- Credible incident reports with documentation
- Scientific research and sensor data

4. PARAPSYCHOLOGY & CONSCIOUSNESS RESEARCH

PRIMARY TARGETS:
@Stanford @Harvard @Princeton @MIT @Yale
@NaturePortfolio @ScienceMagazine @PLOSONE

SECONDARY SOURCES:
Academic researchers and institutions with active programs

Collection Focus:
- Peer-reviewed publications
- Research program announcements
- Conference proceedings
- Institutional funding and grants

INTELLIGENCE METHODOLOGY:

1. SIGNAL COLLECTION:
- Monitor each target account for posts in collection period
- Flag high-priority indicators (FLASH/PRIORITY/ROUTINE)
- Note post timestamps for timeline correlation

2. SIGNAL ANALYSIS:
- Cross-reference multiple sources for verification
- Identify patterns and anomalies
- Distinguish official statements from speculation
- Assess source credibility and potential bias

3. INTELLIGENCE PRODUCTION:
- Synthesize signals into coherent intelligence picture
- Provide strategic context and implications
- Highlight information gaps and collection needs
- Recommend follow-up collection priorities

REPORTING FORMAT:

For each PIR section:
- Lead with BLUF (Bottom Line Up Front)
- Cite specific X accounts and timestamps
- Include direct quotes from key signals when relevant
- Provide analytic assessment (high/medium/low confidence)
- Note strategic implications

Use professional intelligence language:
- "OSINT indicates..." / "Open source reporting suggests..."
- "Multiple sources confirm..." / "Unconfirmed reports from..."
- "Strategic assessment:" / "Operational implications:"
- "Collection gaps:" / "Recommend monitoring..."

VALIDATION REQUIREMENTS:
- Ukraine-Russia conflict MUST be addressed (ongoing war)
- Middle East situation MUST be covered (active conflicts)
- All examples from """ + year + """ (current operational period)
- Minimum 3 specific X account citations per section

Execute collection now."""

        print("Initiating SIGINT collection with Grok 4.1...")
        content, error = generate_with_grok(prompt_text)

        if content:
            provider = "Grok 4.1 Fast Reasoning - SIGINT Collection"
            badge = "GROK-4.1-SIGINT"
        else:
            print("Primary collection failed: " + str(error))
            content, error = generate_with_groq(prompt_text)
            if content:
                provider = "Groq Llama 3.3 (Backup Collection)"
                badge = "GROQ-BACKUP"
            else:
                raise Exception("All collection sources failed: " + str(error))

        html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Trident SIGINT Brief</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui;background:linear-gradient(135deg,#0a0e27,#1a1f3a);color:#e0e6ed;padding:20px;line-height:1.6}.container{max-width:1200px;margin:0 auto;background:rgba(15,23,42,0.9);border:1px solid rgba(59,130,246,0.3);border-radius:12px;overflow:hidden}.header{background:linear-gradient(135deg,#1e293b,#0f172a);border-bottom:2px solid #3b82f6;padding:40px}.badge{background:#dc2626;color:white;padding:4px 12px;font-size:11px;font-weight:700;border-radius:3px;display:inline-block;margin-bottom:15px}h1{font-size:2.5em;color:#3b82f6;text-transform:uppercase;margin-bottom:10px}.meta{color:#94a3b8;font-size:0.9em;margin-top:10px}.sigint{color:#fbbf24;font-size:0.8em;font-weight:600;margin-top:5px}.content{padding:40px}pre{white-space:pre-wrap;font-family:inherit;line-height:1.7}.footer{background:#0f172a;border-top:1px solid rgba(59,130,246,0.3);padding:25px;text-align:center;color:#64748b;font-size:0.85em}</style></head><body><div class="container"><div class="header"><div class="badge">CLASSIFIED: SIGINT COLLECTION BRIEF</div><h1>‚öîÔ∏è THE TRIDENT BRIEF</h1><div class="meta">Collection Period: ' + timestamp + ' | Source: ' + badge + '</div><div class="sigint">SIGNALS INTELLIGENCE | X/TWITTER MONITORING | HIGH-VALUE TARGETS</div></div><div class="content"><pre>' + content + '</pre></div><div class="footer">AUTOMATED SIGINT COLLECTION SYSTEM | ' + provider + ' | DAILY 07:00 UTC<br>MONITORING 100+ HIGH-VALUE X ACCOUNTS</div></div></body></html>'

        with open('index.html', 'w') as f:
            f.write(html)

        print("SIGINT brief generated and published!")
        ENDOFFILE
        
    - name: Generate brief
      env:
        GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      run: python3 generate.py
        
    - name: Commit and push
      run: |
        git config user.name "Trident SIGINT"
        git config user.email "sigint@trident.ai"
        git add index.html
        git diff-index --quiet HEAD || git commit -m "üéØ SIGINT Collection Brief - $(date -u +'%Y-%m-%d')"
        git push
